<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>cps/cpsbase/cpsvar.ml</title>
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1.0">
    <link href="/dist/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/css/my.css" rel="stylesheet" media="screen">
    <link rel="alternate" type="application/rss+xml" title="L language - blog" href="/blog/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="L language - blog" href="/blog/atom.xml" />

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-42249123-1', 'l-lang.org');
      ga('send', 'pageview');
    </script>

  </head>

  <body>
     




   <div class="navbar navbar-inverse navbar-fixed-top navbar-default">
     <div class="container">
       <div class="navbar-header">
         <button
            type="button" class="navbar-toggle" data-toggle="collapse"
            data-target="#my-navbar">
           <span class="sr-only">Toggle navigation</span>
           
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
         </button>
         <a class="navbar-brand" href="/"><i>The</i> L <i>language</i></a>
       </div>
       <div id="my-navbar" class="navbar-collapse collapse">
             <ul class="nav navbar-nav">
               

               
               
               

               
               <li class="dropdown">
                 <a href="/documentation/compiler_hyperbook" class="dropdown-toggle"
                    data-toggle="dropdown"> Documentation <b class="caret"></b> </a>
                 <ul class="dropdown-menu list-group">
                   <li class="dropdown-header">Introduction to L</li>
                   <li><a href="/documentation/intro/short">A tour of L (short intro)</a></li>
                   <li><a href="/documentation/intro/long">Descent into L (long intro)</a></li>
                   <li role="presentation" class="divider"></li>
                   <li class="dropdown-header">Inside the compiler</li>
                   <li><a href="/documentation/compiler_hyperbook/compilation_passes.ml">Compiler hyperbook</a></li>
                 </ul>
               </li>

               

               <li class="dropdown">
                 <a href="/blog" class="dropdown-toggle"
                    data-toggle="dropdown"> Blog <b class="caret"></b> </a>
                 <ul class="dropdown-menu">
                   <li class="dropdown-header">Recent posts</li>
                   
                   <li><a href="/blog/TDOP---Pratt-parser-in-pictures">TDOP / Pratt parser in pictures</a></li>
                   
                   <li><a href="/blog/Structuring-the-compiler">Structuring the compiler</a></li>
                   
                   <li><a href="/blog/Compiling-pattern-matching">Compiling pattern matching</a></li>
                   
                   <li><a href="/blog/A-framework-for-CPS-transformation-and-a-Github-account">A framework for CPS transformation (and a Github account)</a></li>
                   
                   <li><a href="/blog/Using-OCaml-packages-with-ocamlbuild-a-recipe">Using OCaml packages with ocamlbuild: a recipe</a></li>
                   
                   <li><a href="/blog/A-literate-union-find-data-structure">A literate union-find data structure</a></li>
                   
                   <li><a href="/blog/CPS-to-LLVM-SSA-conversion-in-literate-programming">CPS to LLVM SSA conversion in literate programming</a></li>
                   
                   <li><a href="/blog/Incorporating-C-code-in-an-Ocaml-project-using-Ocamlbuild">Incorporating C code in an Ocaml project using Ocamlbuild</a></li>
                   
                   <li><a href="/blog/A-typecast-with-many-uses">A typecast with many uses</a></li>
                   
                   <li><a href="/blog/Guaranteed-optimizations-for-system-programming-languages">Guaranteed optimizations for system programming languages</a></li>
                   
                   <li class="divider"></li>
                   <li><a href="/blog">More blog entries...</a></li>
                 </ul>
               </li>

               <li><a href="https://github.com/mlemerre/l-lang">GitHub</a></li>

             </ul>

             
           </div><!--/.nav-collapse -->
         </div>
       </div>

     <div class="container">
     <div class="row">
  <div class="col-md-3">
    <ul class="nav nav-list">
      <li class="nav-header">
        <a href="/documentation/compiler_hyperbook">Compiler HyperBook</a></li>
      <div class="css-treeview" >
       <ul>
   <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/compilation_passes" /><label for="/documentation/compiler_hyperbook/compilation_passes">&#x2013;</label> <a href="/documentation/compiler_hyperbook/compilation_passes.ml">compilation_passes.ml</a> </li>
   <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/cps" /><label for="/documentation/compiler_hyperbook/cps">&#x25B7;</label> cps
     <ul>
       <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpsbase" /><label for="/documentation/compiler_hyperbook/cps/cpsbase">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase.mli">cpsbase.mli</a>
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsast" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsast">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsast.ml">cpsast.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck.ml">cpscheck.ml</a> </li>
           <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.mli">cpsdef.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.ml">cpsdef.ml</a></li></ul> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint.ml">cpsprint.ml</a> </li>
           <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.mli">cpsvar.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.ml">cpsvar.ml</a></li></ul> </li>
         </ul>
       </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsconvertclosures" /><label for="/documentation/compiler_hyperbook/cps/cpsconvertclosures">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsconvertclosures.ml">cpsconvertclosures.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsfree" /><label for="/documentation/compiler_hyperbook/cps/cpsfree">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsfree.ml">cpsfree.ml</a> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpstransform" /><label for="/documentation/compiler_hyperbook/cps/cpstransform">&#x25B7;</label> cpstransform
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/base" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/base">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/base.ml">base.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/definition" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/definition.ml">definition.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/expression" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/expression.ml">expression.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/rules" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/rules">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/rules.ml">rules.ml</a> </li>
         </ul>
       </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/llvm" /><label for="/documentation/compiler_hyperbook/llvm">&#x25B7;</label> llvm
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/llvm" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.mli">cpsllvm.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x2013;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.ml">cpsllvm.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/parser" /><label for="/documentation/compiler_hyperbook/parser">&#x25B7;</label> parser
     <ul>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/common" /><label for="/documentation/compiler_hyperbook/parser/common">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/common.ml">common.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/definition" /><label for="/documentation/compiler_hyperbook/parser/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/definition.ml">definition.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/expression" /><label for="/documentation/compiler_hyperbook/parser/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/expression.ml">expression.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/path" /><label for="/documentation/compiler_hyperbook/parser/path">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/path.ml">path.ml</a> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/parser" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.mli">tdop.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.ml">tdop.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/support" /><label for="/documentation/compiler_hyperbook/support">&#x25B7;</label> support
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/union_find.mli">union_find.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/union_find.ml">union_find.ml</a></li></ul> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/unique.mli">unique.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/unique.ml">unique.ml</a></li></ul> </li>
     </ul>
   </li>
 </ul>

      </div>
    </ul>
  </div>
  <div class="col-md-9">
    <div class="post-title">
      <h1>cps/cpsbase/cpsvar.ml</h1>
    </div>
    
<!--CUT STYLE article--><!--CUT DEF section 1 --><!--TOC section id="sec1" Module Cpsvar-->
<h2 id="sec1" class="section">Module Cpsvar</h2><!--SEC END --><p>
<span style="font-weight:bold">1.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:41"></a>This file implements links between variables, following the
"Compiling with continuations, continued" paper by Andrew Kennedy,
and "Shrinking lambda expressions in linear time", by Andrew Appel
and Trevor Jim.</p><p>Occurrences are linked to one another into a doubly-linked list,
such that the doubly-linked list represents the set of all
occurrences of a variable. A variable is linked to one of its
occurrence (and thus to the set of all occurrences of the
variable). This allows adding occurrence, removing occurence, and
knowing if there is 0,1, or more occurrence to a variable, in O(1)
time.</p><p>The set of all occurrences of all variables is partitionned into
same-binder equivalence classes using a union-find data structure,
i.e. all the members of a partition are occurrences of the same
variable. The description of the partition is the binding variable
itself. This allows near-constant time access to the binding
variable, and merging of occurrence sets.</p><p>We chose to keep normal occurrences, and recursive occurrences, in
two separate equivalence classes. Not merging them:
</p><ul class="itemize"><li class="li-itemize">
allows to replace the binding variable for only the normal
occurrences, or only the recursive occurrences;
</li><li class="li-itemize">simplifies the implementation of <code>replace_with</code>;
</li><li class="li-itemize">makes each equivalence class smaller (and thus slightly more
efficient).
</li></ul><p> 
<BR><a id="src/cps/cpsbase/cpsvar.ml:1457"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Union_find</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Union_find.Safe</span></p><p></code></div>
Note: a minor problem here is that the unique id is shared between
all applications of Cpsvar.Make, but this is not a huge issue. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:1635"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">UniqueId</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Unique.Make</span>(<span style="color: #0000ff; font-weight: bold;">struct</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">end</span>)<BR></code></div><span style="font-weight:bold">2.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:1682"></a>Variables link to their description, to one occurrence and one
recursive occurrence (if there is one). We also add a unique id to
allow variable comparison. Also, unique variables remove any need
for alpha conversion. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:1911"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;(&#X3B1;,&#X3B2;)&nbsp;variable&nbsp;=<BR>&nbsp;&nbsp;
{&nbsp;<span style="color: #a020f0; ">mutable</span>&nbsp;var_desc:&nbsp;&#X3B1;&nbsp;initialized;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">mutable</span>&nbsp;occurrences:(&#X3B1;,&nbsp;&#X3B2;)&nbsp;occurrence&nbsp;<span style="color: #228b22; ">option</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">mutable</span>&nbsp;recursive_occurrences:&nbsp;(&#X3B1;,&nbsp;&#X3B2;)&nbsp;occurrence&nbsp;<span style="color: #228b22; ">option</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
var_id:&nbsp;<span style="color: #228b22; ">UniqueId.</span>t;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">mutable</span>&nbsp;occur_nb:&nbsp;<span style="color: #228b22; ">int</span>&nbsp;}</p><p></code></div>
Occurrences need a description; a "union-find link" (to retrieve
the binding variable, which is the description of the union-find
partition); and the links of the doubly-linked lists. We also
number the occurrences of a variable, to help in debugging and ease
comparison between occurrences. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:2451"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;(&#X3B1;,&#X3B2;)&nbsp;occurrence&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
{&nbsp;<span style="color: #a020f0; ">mutable</span>&nbsp;occur_desc:&nbsp;&#X3B2;&nbsp;initialized;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">mutable</span>&nbsp;link_var:&nbsp;((&#X3B1;,&nbsp;&#X3B2;)&nbsp;variable,(&#X3B1;,&nbsp;&#X3B2;)&nbsp;occurrence)&nbsp;<span style="color: #228b22; ">Union_find.</span>link;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">mutable</span>&nbsp;next_occurrence:(&#X3B1;,&nbsp;&#X3B2;)&nbsp;occurrence;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">mutable</span>&nbsp;previous_occurrence:(&#X3B1;,&nbsp;&#X3B2;)&nbsp;occurrence;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occur_id:&nbsp;<span style="color: #228b22; ">int</span>&nbsp;}</p><p></code></div>
We have to check that the user does not retrieve the description
until the variable is initialized, or that it does not overwrite an
already initialized description. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:2907"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;&#X3B1;&nbsp;initialized&nbsp;=&nbsp;<span style="color: #228b22; ">Undef</span>&nbsp;&#X2223;&nbsp;<span style="color: #228b22; ">Initialized_to</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;&#X3B1;<BR></code></div><span style="font-weight:bold">3.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:2962"></a><code>occur_type</code> distinguish between normal and recursive occurrences.
The following functions allows code factorisation. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:3087"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;occur_type&nbsp;=&nbsp;<span style="color: #228b22; ">Recursive</span>&nbsp;&#X2223;&nbsp;<span style="color: #228b22; ">Non_recursive</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:3134"></a>
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;get_occurrences&nbsp;var&nbsp;(ot:occur_type)&nbsp;=&nbsp;<span style="color: #a020f0; ">match</span>&nbsp;ot&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Recursive</span>&nbsp;&#X2192;&nbsp;var.occurrences<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Non_recursive</span>&nbsp;&#X2192;&nbsp;var.recursive_occurrences</p><p><a id="src/cps/cpsbase/cpsvar.ml:3273"></a>
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;set_occurrences&nbsp;var&nbsp;(ot:occur_type)&nbsp;value&nbsp;=&nbsp;<span style="color: #a020f0; ">match</span>&nbsp;ot&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Recursive</span>&nbsp;&#X2192;&nbsp;(var.occurrences&nbsp;&#X2190;&nbsp;value)<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Non_recursive</span>&nbsp;&#X2192;&nbsp;(var.recursive_occurrences&nbsp;&#X2190;&nbsp;value)<BR></code></div><span style="font-weight:bold">4.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:3442"></a>The CPSVar functor takes a DESCRIPTION argument as explained in the interface. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:3527"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;<span style="color: #228b22; ">DESCRIPTION</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">sig</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;variable_description<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;occurrence_description<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;var_prefix:<span style="color: #228b22; ">string</span><BR>
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:3645"></a>
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Make</span>(<span style="color: #228b22; ">Desc</span>:<span style="color: #228b22; ">DESCRIPTION</span>)&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">struct</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:3685"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;var_desc&nbsp;=&nbsp;<span style="color: #228b22; ">Desc.</span>variable_description<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;occur_desc&nbsp;=&nbsp;<span style="color: #228b22; ">Desc.</span>occurrence_description<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;var&nbsp;=&nbsp;(var_desc,&nbsp;occur_desc)&nbsp;variable<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;occur&nbsp;=&nbsp;(var_desc,&nbsp;occur_desc)&nbsp;occurrence<BR></code></div><span style="font-weight:bold">5.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:3876"></a>Occurrences contain a link variable, used by the union-find
functor. The description of a partition of an occurrence <code>occur</code>
is the variable <code>var</code> for which <code>occur</code> is an occurrence. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:4072"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Var_union_find</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Union_find.Make</span>(<span style="color: #0000ff; font-weight: bold;">struct</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;description&nbsp;=&nbsp;var<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;element&nbsp;=&nbsp;occur<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;set&nbsp;f&nbsp;v&nbsp;=&nbsp;f.link_var&nbsp;&#X2190;&nbsp;v<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;get&nbsp;f&nbsp;=&nbsp;f.link_var<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span>)</p><p></code></div>&nbsp;&nbsp;
The Union-find module requires a "union-find data structure"
(ufds) as its first argument. Ideally, we should have one such
ufds per CPS term, as a variable and all its occurrences cannot
be shared between several terms. However, using a single ufds for
all terms in a global variable is more practical (no need to pass
an additional argument). Moreover, confusion between partitions
of several terms should be relatively easy to avoid, so checking
that with several ufds is not absolutely necessary. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:4786"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;ufds&nbsp;=&nbsp;<span style="color: #228b22; ">Var_union_find.</span>create()</p><p><a id="src/cps/cpsbase/cpsvar.ml:4826"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Var</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">struct</span><BR></code></div><span style="font-weight:bold">6.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:4855"></a>The tryptic make/description/set_description allows building
circular structures without simultaneous definitions.
<code>var_counter</code> provides unique identifiers when displaying
variables. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:5063"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;make()&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
{&nbsp;var_desc&nbsp;=&nbsp;<span style="color: #228b22; ">Undef</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occurrences&nbsp;=&nbsp;<span style="color: #228b22; ">None</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
recursive_occurrences&nbsp;=&nbsp;<span style="color: #228b22; ">None</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
var_id&nbsp;=&nbsp;<span style="color: #228b22; ">UniqueId.</span>fresh();<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occur_nb&nbsp;=&nbsp;0&nbsp;}&nbsp;</p><p><a id="src/cps/cpsbase/cpsvar.ml:5234"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;description&nbsp;b&nbsp;=&nbsp;<span style="color: #a020f0; ">match</span>&nbsp;b.var_desc&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Initialized_to</span>(d)&nbsp;&#X2192;&nbsp;d<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Undef</span>&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;<span style="color: #a020f0; ">false</span>&nbsp;<span style="color: #b22222">(&#X2217;  Trying to access an uninitialized description.  &#X2217;)</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:5396"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;set_description&nbsp;b&nbsp;d&nbsp;=&nbsp;<span style="color: #a020f0; ">match</span>&nbsp;b.var_desc&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Initialized_to</span>(d)&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;<span style="color: #a020f0; ">false</span>&nbsp;<span style="color: #b22222">(&#X2217;  Description already initialized.  &#X2217;)</span>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Undef</span>&nbsp;&#X2192;&nbsp;b.var_desc&nbsp;&#X2190;&nbsp;<span style="color: #228b22; ">Initialized_to</span>(d)<BR></code></div><span style="font-weight:bold">7.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:5590"></a>Occurrence number can return in O(1) whether a variable has
no, one, or more than one occurrence. For that we must not
return the list of occurrence if there are several; instead the
user must then use the <code>fold_on_occurrences</code> function. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:5851"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;number_of_occurrences&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">No_occurrence</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">One_occurrence</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;occur<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Several_occurrences</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:5967"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;number_of_occurrences_&nbsp;ot&nbsp;var&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;get_occurrences&nbsp;var&nbsp;ot&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">None</span>&nbsp;&#X2192;&nbsp;<span style="color: #228b22; ">No_occurrence</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(occ)&nbsp;&#X2192;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">if</span>&nbsp;occ.previous_occurrence&nbsp;&#X2261;&nbsp;occ<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">then</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">begin</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">assert</span>&nbsp;(occ.next_occurrence&nbsp;&#X2261;&nbsp;occ);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">One_occurrence</span>&nbsp;occ<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">else</span>&nbsp;<span style="color: #228b22; ">Several_occurrences</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:6300"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;number_of_occurrences&nbsp;=&nbsp;number_of_occurrences_&nbsp;<span style="color: #228b22; ">Non_recursive</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:6370"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;fold_on_occurrences_&nbsp;ot&nbsp;var&nbsp;init&nbsp;f&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;get_occurrences&nbsp;var&nbsp;ot&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">None</span>&nbsp;&#X2192;&nbsp;init<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(occ)&nbsp;&#X2192;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">rec</span>&nbsp;loop&nbsp;value&nbsp;cur&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">if</span>&nbsp;cur&nbsp;&#X2261;&nbsp;occ<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">then</span>&nbsp;f&nbsp;value&nbsp;cur<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">else</span>&nbsp;loop&nbsp;(f&nbsp;value&nbsp;cur)&nbsp;cur.next_occurrence<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">in</span>&nbsp;loop&nbsp;init&nbsp;occ.next_occurrence</p><p><a id="src/cps/cpsbase/cpsvar.ml:6694"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;fold_on_occurrences&nbsp;var&nbsp;init&nbsp;f&nbsp;=&nbsp;fold_on_occurrences_&nbsp;<span style="color: #228b22; ">Non_recursive</span>&nbsp;var&nbsp;init&nbsp;f<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;fold_on_recursive_occurrences&nbsp;var&nbsp;init&nbsp;f&nbsp;=&nbsp;fold_on_occurrences_&nbsp;<span style="color: #228b22; ">Recursive</span>&nbsp;var&nbsp;init&nbsp;f<BR></code></div><span style="font-weight:bold">8.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:6882"></a>This function allows "merging" of variables in O(1) time:
merging the doubly-linked lists is a O(1) operation, and so is
performing union in the union-find algorithm. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:7066"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;replace_with_&nbsp;ot&nbsp;old&nbsp;new_&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;get_occurrences&nbsp;old&nbsp;ot&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  If there were already no occurrences of <code>old</code>, there is
nothing to do.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">None</span>&nbsp;&#X2192;&nbsp;()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(occ_old)&nbsp;<span style="color: #a020f0; ">as</span>&nbsp;some_occ_old&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
((<span style="color: #a020f0; ">match</span>&nbsp;get_occurrences&nbsp;new_&nbsp;ot&nbsp;<span style="color: #a020f0; ">with</span></p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
If new_ had no occurrences, there is no need for full
list merge and union-find: we can just update the
partition description. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:7503"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">None</span>&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
set_occurrences&nbsp;new_&nbsp;ot&nbsp;some_occ_old;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;part_old&nbsp;=&nbsp;<span style="color: #228b22; ">Var_union_find.</span>find&nbsp;ufds&nbsp;occ_old&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Var_union_find.</span>set_description&nbsp;ufds&nbsp;part_old&nbsp;new_</p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
The non-trivial case: merge the two circular
doubly-linked lists into one big circular doubly-linked
list. Also works on single-elements lists. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:7871"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(occ_new)&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occ_old.next_occurrence.previous_occurrence&nbsp;&#X2190;&nbsp;occ_new.previous_occurrence;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occ_new.previous_occurrence.next_occurrence&nbsp;&#X2190;&nbsp;occ_old.next_occurrence;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occ_old.next_occurrence&nbsp;&#X2190;&nbsp;occ_new;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occ_new.previous_occurrence&nbsp;&#X2190;&nbsp;occ_old;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;(part_old,part_new)&nbsp;=&nbsp;(<span style="color: #228b22; ">Var_union_find.</span>find&nbsp;ufds&nbsp;occ_old,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Var_union_find.</span>find&nbsp;ufds&nbsp;occ_new)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ignore(<span style="color: #228b22; ">Var_union_find.</span>union&nbsp;ufds&nbsp;part_old&nbsp;part_new&nbsp;new_));</p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<code>old</code> can be reused if needed. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:8423"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
set_occurrences&nbsp;old&nbsp;ot&nbsp;<span style="color: #228b22; ">None</span>)</p><p><a id="src/cps/cpsbase/cpsvar.ml:8464"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;replace_with&nbsp;old&nbsp;new_&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
replace_with_&nbsp;<span style="color: #228b22; ">Recursive</span>&nbsp;old&nbsp;new_;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
replace_with_&nbsp;<span style="color: #228b22; ">Non_recursive</span>&nbsp;old&nbsp;new_</p><p><a id="src/cps/cpsbase/cpsvar.ml:8582"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;replace_all_non_recursive_occurrences_of_with&nbsp;old&nbsp;new_&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
replace_with_&nbsp;<span style="color: #228b22; ">Non_recursive</span>&nbsp;old&nbsp;new_<BR></code></div><span style="font-weight:bold">9.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:8701"></a>Utility functions. Comparison is done using the unique ids;
this allows faster comparisons, and avoid looping indefinitely
when there are cyclic references between a <code>var</code> and its
<code>description</code>.
<BR><a id="src/cps/cpsbase/cpsvar.ml:8918"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;to_string&nbsp;bv&nbsp;=&nbsp;<span style="color: #228b22; ">Desc.</span>var_prefix&nbsp;^&nbsp;(<span style="color: #228b22; ">UniqueId.</span>to_string&nbsp;bv.var_id)</p><p><a id="src/cps/cpsbase/cpsvar.ml:8993"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Ord</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">struct</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;t&nbsp;=&nbsp;var<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;compare&nbsp;a&nbsp;b&nbsp;=&nbsp;compare&nbsp;a.var_id&nbsp;b.var_id<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:9095"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Map</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Map.Make</span>(<span style="color: #228b22; ">Ord</span>)</p><p><a id="src/cps/cpsbase/cpsvar.ml:9128"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Set</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Set.Make</span>(<span style="color: #228b22; ">Ord</span>)</p><p><a id="src/cps/cpsbase/cpsvar.ml:9162"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:9171"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Occur</span>&nbsp;=&nbsp;<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">struct</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:9199"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;maker&nbsp;=&nbsp;var&nbsp;Ã—&nbsp;occur_type</p><p><a id="src/cps/cpsbase/cpsvar.ml:9236"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;maker&nbsp;v&nbsp;=&nbsp;(v,<span style="color: #228b22; ">Non_recursive</span>)</p><p><a id="src/cps/cpsbase/cpsvar.ml:9274"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;rec_maker&nbsp;v&nbsp;=&nbsp;(v,<span style="color: #228b22; ">Recursive</span>)<BR></code></div><span style="font-weight:bold">10.</span>&nbsp;
<a id="src/cps/cpsbase/cpsvar.ml:9319"></a>Create a new occurrence of VAR, i.e. add it to the
doubly-linked list of all the occurrences of VAR, and to the
union-find partition of the occurrences of VAR. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:9496"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;make&nbsp;(var,ot)&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Create an initial self-linked occurrence of var.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;self_linked_occur&nbsp;var&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
var.occur_nb&nbsp;&#X2190;&nbsp;var.occur_nb&nbsp;+&nbsp;1;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">rec</span>&nbsp;occur&nbsp;=&nbsp;{&nbsp;occur_desc&nbsp;=&nbsp;<span style="color: #228b22; ">Undef</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
link_var&nbsp;=&nbsp;<span style="color: #228b22; ">Union_find.</span>empty_link;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
next_occurrence&nbsp;=&nbsp;occur;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
previous_occurrence&nbsp;=&nbsp;occur;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
occur_id&nbsp;=&nbsp;var.occur_nb;&nbsp;}&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">in</span>&nbsp;occur<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;get_occurrences&nbsp;var&nbsp;ot&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  If this is the first occurrence of var.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">None</span>&nbsp;&#X2192;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;new_occur&nbsp;=&nbsp;self_linked_occur&nbsp;var&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ignore(<span style="color: #228b22; ">Var_union_find.</span>singleton&nbsp;ufds&nbsp;new_occur&nbsp;var);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
set_occurrences&nbsp;var&nbsp;ot&nbsp;(<span style="color: #228b22; ">Some</span>(new_occur));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
new_occur<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Else there are already some occurrences of var.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(existing_occur)&nbsp;&#X2192;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;new_occur&nbsp;=&nbsp;self_linked_occur&nbsp;var&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Insert new between existing and existing.next.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;following_occur&nbsp;=&nbsp;existing_occur.next_occurrence&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;new_occur&nbsp;=&nbsp;{&nbsp;new_occur<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">with</span>&nbsp;next_occurrence&nbsp;=&nbsp;following_occur;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
previous_occurrence&nbsp;=&nbsp;existing_occur&nbsp;}&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
existing_occur.next_occurrence&nbsp;&#X2190;&nbsp;new_occur;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
following_occur.previous_occurrence&nbsp;&#X2190;&nbsp;new_occur;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Merge new to the partition of occurrences of var.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;new_part&nbsp;=&nbsp;<span style="color: #228b22; ">Var_union_find.</span>singleton&nbsp;ufds&nbsp;new_occur&nbsp;var&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;existing_part&nbsp;=&nbsp;(<span style="color: #228b22; ">Var_union_find.</span>find&nbsp;ufds&nbsp;existing_occur)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ignore(<span style="color: #228b22; ">Var_union_find.</span>union&nbsp;ufds&nbsp;new_part&nbsp;existing_part&nbsp;var);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
new_occur</p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;
Returns the variable of which <code>occur</code> is an occurrence. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:11194"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;binding_variable&nbsp;occur&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;part&nbsp;=&nbsp;<span style="color: #228b22; ">Var_union_find.</span>find&nbsp;ufds&nbsp;occur&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Var_union_find.</span>description&nbsp;ufds&nbsp;part</p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;
Delete <code>occur</code> from the doubly-linked list of occurrences.
Following Andrew Kennedy, the union-find data structure is not
changed. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:11479"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;delete&nbsp;occur&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;next&nbsp;=&nbsp;occur.next_occurrence&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;prev&nbsp;=&nbsp;occur.previous_occurrence&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;var&nbsp;=&nbsp;binding_variable&nbsp;occur&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">if</span>&nbsp;(occur&nbsp;&#X2261;&nbsp;next)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  One-variable case.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">then</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">begin</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">assert</span>&nbsp;(occur&nbsp;&#X2261;&nbsp;prev);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;(var.occurrences,&nbsp;var.recursive_occurrences)&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;(<span style="color: #228b22; ">Some</span>(a),_)&nbsp;<span style="color: #a020f0; ">when</span>&nbsp;a&nbsp;&#X2261;&nbsp;occur&nbsp;&#X2192;&nbsp;var.occurrences&nbsp;&#X2190;&nbsp;<span style="color: #228b22; ">None</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;(_,<span style="color: #228b22; ">Some</span>(a))&nbsp;<span style="color: #a020f0; ">when</span>&nbsp;a&nbsp;&#X2261;&nbsp;occur&nbsp;&#X2192;&nbsp;var.recursive_occurrences&nbsp;&#X2190;&nbsp;<span style="color: #228b22; ">None</span>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;_&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;<span style="color: #a020f0; ">false</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">else</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">begin</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">assert</span>&nbsp;(occur&nbsp;&#X2262;&nbsp;prev);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
prev.next_occurrence&nbsp;&#X2190;&nbsp;next;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
next.previous_occurrence&nbsp;&#X2190;&nbsp;prev;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(<span style="color: #a020f0; ">match</span>&nbsp;var.occurrences&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(a)&nbsp;<span style="color: #a020f0; ">when</span>&nbsp;a&nbsp;&#X2261;&nbsp;occur&nbsp;&#X2192;&nbsp;var.occurrences&nbsp;&#X2190;&nbsp;<span style="color: #228b22; ">Some</span>(prev)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;_&nbsp;&#X2192;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(<span style="color: #a020f0; ">match</span>&nbsp;var.recursive_occurrences&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(a)&nbsp;<span style="color: #a020f0; ">when</span>&nbsp;a&nbsp;&#X2261;&nbsp;occur&nbsp;&#X2192;&nbsp;var.recursive_occurrences&nbsp;&#X2190;&nbsp;<span style="color: #228b22; ">Some</span>(prev)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;_&nbsp;&#X2192;&nbsp;()))</p><p><a id="src/cps/cpsbase/cpsvar.ml:12378"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span></p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;
Similarly to <code><span style="color: #228b22; ">Var</span></code>, description can be get and set only once. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:12464"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;description&nbsp;b&nbsp;=&nbsp;<span style="color: #a020f0; ">match</span>&nbsp;b.occur_desc&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Initialized_to</span>(d)&nbsp;&#X2192;&nbsp;d<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Undef</span>&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;<span style="color: #a020f0; ">false</span>&nbsp;<span style="color: #b22222">(&#X2217;  Trying to access an uninitialized description.  &#X2217;)</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:12628"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;set_description&nbsp;b&nbsp;d&nbsp;=&nbsp;<span style="color: #a020f0; ">match</span>&nbsp;b.occur_desc&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Initialized_to</span>(d)&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;<span style="color: #a020f0; ">false</span>&nbsp;<span style="color: #b22222">(&#X2217;  Description already initialized.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Undef</span>&nbsp;&#X2192;&nbsp;b.occur_desc&nbsp;&#X2190;&nbsp;<span style="color: #228b22; ">Initialized_to</span>(d)</p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;
We suffix the name of the variable by the occurrence number,
which may be useful to follow code transformations steps. 
<BR><a id="src/cps/cpsbase/cpsvar.ml:12955"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;to_string&nbsp;occur&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;bv&nbsp;=&nbsp;binding_variable&nbsp;occur&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(<span style="color: #228b22; ">Var.</span>to_string&nbsp;bv)&nbsp;^&nbsp;<span style="color: #8b2252; ">"_"</span>&nbsp;^&nbsp;(string_of_int&nbsp;occur.occur_id)</p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
We compare occurrences by lexical order of (var_id, occur_id).
We must not use the generic "compare" function, because
Variables and Occurrences can be part of a circular chain of
pointers, and "compare" could loop indefinitely 
<BR><a id="src/cps/cpsbase/cpsvar.ml:13354"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Ord</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">struct</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;t&nbsp;=&nbsp;occur<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;compare&nbsp;a&nbsp;b&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;unique_id&nbsp;o&nbsp;=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;x&nbsp;=&nbsp;binding_variable&nbsp;o&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(x.var_id,&nbsp;o.occur_id)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
compare&nbsp;(unique_id&nbsp;a)&nbsp;(unique_id&nbsp;b)</p><p><a id="src/cps/cpsbase/cpsvar.ml:13572"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:13581"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Map</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Map.Make</span>(<span style="color: #228b22; ">Ord</span>)</p><p><a id="src/cps/cpsbase/cpsvar.ml:13614"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Set</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Set.Make</span>(<span style="color: #228b22; ">Ord</span>)</p><p><a id="src/cps/cpsbase/cpsvar.ml:13647"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/cps/cpsbase/cpsvar.ml:13654"></a>
<span style="color: #0000ff; font-weight: bold;">end</span><BR></code></div></p><!--CUT END -->



    <hr />
  </div>
</div>
 
     </div>
          

   
   <script src="/js/jquery.js"></script>
   

   <script src="/dist/js/bootstrap.min.js"></script>

   

   
   <script type="text/javascript">
   $('.my-email').html(function(){
	var d = "t@l-la";
	var e = "ma";
	var a = "t";
	var c = "ng.org";
	var h = 'mailto:' + e + a + d + c;
	$(this).parent('a').attr('href', h);
	return e + a + d + c;
   });
   </script>

  </body>
</html>
