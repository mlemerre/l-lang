<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>support/union_find.ml</title>
    <meta name="viewport" content="width=device-width,
                                   initial-scale=1.0">
    <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="/css/my.css" rel="stylesheet" media="screen">
    <link href="/css/bootstrap-responsive.min.css" rel="stylesheet"
          media="screen">
    <link rel="alternate" type="application/rss+xml" title="L language - blog" href="/blog/rss.xml" />
    <link rel="alternate" type="application/atom+xml" title="L language - blog" href="/blog/atom.xml" />
  </head>

  <body>
     




     <div class="navbar navbar-inverse navbar-fixed-top">
       <div class="navbar-inner">
         <div class="container">
           <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
           </button>
           <a class="brand" href="/"><i>The</i> L <i>language</i></a>
           <div class="nav-collapse collapse">
             <ul class="nav">
               

               
               
               

               
               <li class="dropdown">
                 <a href="/documentation/compiler_hyperbook" class="dropdown-toggle"
                    data-toggle="dropdown"> Documentation <b class="caret"></b> </a>
                 <ul class="dropdown-menu">
                   <li class="nav-header">Introduction to L</li>
                   
                   <li><a href="/documentation/intro/short">A tour of L (short intro)</a></li>
                   <li><a href="/documentation/intro/long">Descent into L (long intro)</a></li>
                   <li class="nav-header">Inside the compiler</li>
                   <li><a href="/documentation/compiler_hyperbook/compilation_passes.ml">Compiler hyperbook</a></li>
                 </ul>
               </li>

               

               <li class="dropdown">
                 <a href="/blog" class="dropdown-toggle"
                    data-toggle="dropdown"> Blog <b class="caret"></b> </a>
                 <ul class="dropdown-menu">
                   <li class="nav-header">Recent posts</li>
                   
                   <li><a href="/blog/Structuring-the-compiler">Structuring the compiler</a></li>
                   
                   <li><a href="/blog/Compiling-pattern-matching">Compiling pattern matching</a></li>
                   
                   <li><a href="/blog/A-framework-for-CPS-transformation-and-a-Github-account">A framework for CPS transformation (and a Github account)</a></li>
                   
                   <li><a href="/blog/Using-OCaml-packages-with-ocamlbuild-a-recipe">Using OCaml packages with ocamlbuild: a recipe</a></li>
                   
                   <li><a href="/blog/A-literate-union-find-data-structure">A literate union-find data structure</a></li>
                   
                   <li><a href="/blog/CPS-to-LLVM-SSA-conversion-in-literate-programming">CPS to LLVM SSA conversion in literate programming</a></li>
                   
                   <li><a href="/blog/Incorporating-C-code-in-an-Ocaml-project-using-Ocamlbuild">Incorporating C code in an Ocaml project using Ocamlbuild</a></li>
                   
                   <li><a href="/blog/A-typecast-with-many-uses">A typecast with many uses</a></li>
                   
                   <li><a href="/blog/Guaranteed-optimizations-for-system-programming-languages">Guaranteed optimizations for system programming languages</a></li>
                   
                   <li><a href="/blog/My-first-blog-entry">My first blog entry</a></li>
                   
                   <li class="divider"></li>
                   <li><a href="/blog">More blog entries...</a></li>
                 </ul>
               </li>

               <li><a href="https://github.com/mlemerre/l-lang">GitHub</a></li>

             </ul>

             
           </div><!--/.nav-collapse -->
         </div>
       </div>
     </div>

     <div class="container">
     <div class="row">
  <div class="span3">
    <ul class="nav nav-list">
      <li class="nav-header">
        <a href="/documentation/compiler_hyperbook">Compiler HyperBook</a></li>
      <div class="css-treeview" >
       <ul>
   <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/compilation_passes" /><label for="/documentation/compiler_hyperbook/compilation_passes">&#x2013;</label> <a href="/documentation/compiler_hyperbook/compilation_passes.ml">compilation_passes.ml</a> </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/cps" /><label for="/documentation/compiler_hyperbook/cps">&#x25B7;</label> cps
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpsbase" /><label for="/documentation/compiler_hyperbook/cps/cpsbase">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase.mli">cpsbase.mli</a>
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsast" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsast">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsast.ml">cpsast.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpscheck.ml">cpscheck.ml</a> </li>
           <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.mli">cpsdef.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsdef.ml">cpsdef.ml</a></li></ul> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsprint.ml">cpsprint.ml</a> </li>
           <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps/cpsbase" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.mli">cpsvar.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar" /><label for="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsbase/cpsvar.ml">cpsvar.ml</a></li></ul> </li>
         </ul>
       </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsconvertclosures" /><label for="/documentation/compiler_hyperbook/cps/cpsconvertclosures">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsconvertclosures.ml">cpsconvertclosures.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpsfree" /><label for="/documentation/compiler_hyperbook/cps/cpsfree">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpsfree.ml">cpsfree.ml</a> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/cps" id="/documentation/compiler_hyperbook/cps/cpstransform" /><label for="/documentation/compiler_hyperbook/cps/cpstransform">&#x25B7;</label> cpstransform
         <ul>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/base" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/base">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/base.ml">base.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/definition" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/definition.ml">definition.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/expression" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/expression.ml">expression.ml</a> </li>
           <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/cps/cpstransform/rules" /><label for="/documentation/compiler_hyperbook/cps/cpstransform/rules">&#x2013;</label> <a href="/documentation/compiler_hyperbook/cps/cpstransform/rules.ml">rules.ml</a> </li>
         </ul>
       </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/llvm" /><label for="/documentation/compiler_hyperbook/llvm">&#x25B7;</label> llvm
     <ul>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/llvm" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.mli">cpsllvm.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/llvm/cpsllvm" /><label for="/documentation/compiler_hyperbook/llvm/cpsllvm">&#x2013;</label> <a href="/documentation/compiler_hyperbook/llvm/cpsllvm.ml">cpsllvm.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox"  name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/parser" /><label for="/documentation/compiler_hyperbook/parser">&#x25B7;</label> parser
     <ul>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/common" /><label for="/documentation/compiler_hyperbook/parser/common">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/common.ml">common.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/definition" /><label for="/documentation/compiler_hyperbook/parser/definition">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/definition.ml">definition.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/expression" /><label for="/documentation/compiler_hyperbook/parser/expression">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/expression.ml">expression.ml</a> </li>
       <li> <input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/path" /><label for="/documentation/compiler_hyperbook/parser/path">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/path.ml">path.ml</a> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/parser" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.mli">tdop.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/parser/tdop" /><label for="/documentation/compiler_hyperbook/parser/tdop">&#x2013;</label> <a href="/documentation/compiler_hyperbook/parser/tdop.ml">tdop.ml</a></li></ul> </li>
     </ul>
   </li>
   <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook" id="/documentation/compiler_hyperbook/support" /><label for="/documentation/compiler_hyperbook/support">&#x25B7;</label> support
     <ul>
       <li> <input type="checkbox" checked="checked" name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/union_find.mli">union_find.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/union_find" /><label for="/documentation/compiler_hyperbook/support/union_find">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/union_find.ml">union_find.ml</a></li></ul> </li>
       <li> <input type="checkbox"  name="/documentation/compiler_hyperbook/support" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x25B7;</label> <a href="/documentation/compiler_hyperbook/support/unique.mli">unique.mli</a><ul><li><input type="checkbox" disabled="disabled" id="/documentation/compiler_hyperbook/support/unique" /><label for="/documentation/compiler_hyperbook/support/unique">&#x2013;</label> <a href="/documentation/compiler_hyperbook/support/unique.ml">unique.ml</a></li></ul> </li>
     </ul>
   </li>
 </ul>

      </div>
    </ul>
  </div>
  <div class="span9">
    <div class="post-title">
      <h1>support/union_find.ml</h1>
    </div>
    
<!--CUT STYLE article--><!--CUT DEF section 1 --><!--TOC section id="sec1" Module Union_find-->
<h2 id="sec1" class="section">Module Union_find</h2><!--SEC END --><p>
<span style="font-weight:bold">1.</span>&nbsp;
<a id="src/support/union_find.ml:41"></a>We represent each disjoint set by a tree : elements are in the
same set than the element that they point to.</p><p>The root of the tree is the representative of the set, and
corresponds to elements of type <code>partition</code>. It points to a
"partition descriptor". 
<BR><a id="src/support/union_find.ml:307"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;(&#X3B1;,&#X3B2;)&nbsp;baselink&nbsp;=&nbsp;<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Partition_descriptor</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;&#X3B1;&nbsp;partition_descriptor<BR>&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Parent</span>&nbsp;<span style="color: #a52a2a; ">of</span>&nbsp;&#X3B2;</p><p></code></div>
The partition descriptor contains the user-accessible description,
and a rank, used to optimize the union operation.</p><p>Note that the partition descriptor is not accessible by the users
of the module, and the interface make it so that there can be only
one link to the partition descriptor (from the representative).
This allows to update the partition descriptor destructively. 
<BR><a id="src/support/union_find.ml:825"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;&#X3B1;&nbsp;partition_descriptor&nbsp;=&nbsp;{&nbsp;<span style="color: #a020f0; ">mutable</span>&nbsp;rank:rank;&nbsp;<span style="color: #a020f0; ">mutable</span>&nbsp;desc:&#X3B1;&nbsp;}</p><p></code></div>
The rank of a partition is is a majorant of the distance of its
elements to the root (path compression makes so that the height of
the tree can be lower than the rank). The union operation minimizes
the rank, and thus the height of the tree. 
<BR><a id="src/support/union_find.ml:1152"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">and</span>&nbsp;rank&nbsp;=&nbsp;<span style="color: #228b22; ">int</span><BR></code></div><span style="font-weight:bold">2.</span>&nbsp;
<a id="src/support/union_find.ml:1172"></a>The implementation is parametrized by the safety checks that we
perform (which differs between the Fast and Safe modules). </p><p>The safe module identifies all union-find data structures by a
unique id, embed that in the links, and checks for all operation
that they are equal. It also checks initialization of the link. 
<BR><a id="src/support/union_find.ml:1504"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;<span style="color: #228b22; ">SAFETY</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">sig</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;t<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;create:&nbsp;<span style="color: #228b22; ">unit</span>&nbsp;&#X2192;&nbsp;t<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link</p><p><a id="src/support/union_find.ml:1583"></a>&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Create a safe link from a baselink.  &#X2217;)</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;securize:&nbsp;t&nbsp;&#X2192;&nbsp;(&#X3B1;,&#X3B2;)&nbsp;baselink&nbsp;&#X2192;&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link</p><p><a id="src/support/union_find.ml:1683"></a>&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Returns the base_link from the safe link.  &#X2217;)</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;get_base:&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link&nbsp;&#X2192;&nbsp;(&#X3B1;,&#X3B2;)&nbsp;baselink</p><p><a id="src/support/union_find.ml:1784"></a>&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Check the safe link withat the element (and the safe link) belong to t.  &#X2217;)</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;check_membership:&nbsp;t&nbsp;&#X2192;&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link&nbsp;&#X2192;&nbsp;<span style="color: #228b22; ">unit</span></p><p><a id="src/support/union_find.ml:1916"></a>&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Check that the element is not yet part of any union find.  &#X2217;)</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;check_unused:&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link&nbsp;&#X2192;&nbsp;<span style="color: #228b22; ">unit</span></p><p><a id="src/support/union_find.ml:2025"></a>&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Initial link.  &#X2217;)</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;empty_link:&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link<BR>
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/support/union_find.ml:2086"></a>
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">No_safety</span>:<span style="color: #228b22; ">SAFETY</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">struct</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;t&nbsp;=&nbsp;<span style="color: #228b22; ">unit</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;create()&nbsp;=&nbsp;()<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link&nbsp;=&nbsp;(&#X3B1;,&#X3B2;)&nbsp;baselink</p><p><a id="src/support/union_find.ml:2196"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;securize&nbsp;()&nbsp;l&nbsp;=&nbsp;l</p><p><a id="src/support/union_find.ml:2222"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;check_membership&nbsp;()&nbsp;l&nbsp;=&nbsp;()</p><p><a id="src/support/union_find.ml:2257"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;check_unused&nbsp;l&nbsp;=&nbsp;()</p><p><a id="src/support/union_find.ml:2285"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;get_base&nbsp;l&nbsp;=&nbsp;l</p><p><a id="src/support/union_find.ml:2308"></a>&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Note: This cast can make the execution fail without notice.  &#X2217;)</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;empty_link&nbsp;=&nbsp;<span style="color: #228b22; ">Obj.</span>magic&nbsp;0&nbsp;<BR>
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/support/union_find.ml:2423"></a>
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;unique&nbsp;=&nbsp;<span style="color: #228b22; ">int</span></p><p><a id="src/support/union_find.ml:2442"></a>
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Unique</span>&nbsp;=&nbsp;<span style="color: #228b22; ">Unique.Make</span>(<span style="color: #0000ff; font-weight: bold;">struct</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">end</span>)</p><p><a id="src/support/union_find.ml:2483"></a>
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Safety</span>:<span style="color: #228b22; ">SAFETY</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">struct</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;t&nbsp;=&nbsp;<span style="color: #228b22; ">Unique.</span>t<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;create()&nbsp;=&nbsp;<span style="color: #228b22; ">Unique.</span>fresh()</p><p><a id="src/support/union_find.ml:2567"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link&nbsp;=&nbsp;t&nbsp;<span style="color: #228b22; ">option</span>&nbsp;Ã—&nbsp;(&#X3B1;,&#X3B2;)&nbsp;baselink</p><p><a id="src/support/union_find.ml:2619"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;securize&nbsp;u&nbsp;l&nbsp;=&nbsp;(<span style="color: #228b22; ">Some</span>&nbsp;u,l)</p><p><a id="src/support/union_find.ml:2653"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;check_membership&nbsp;t&nbsp;(u,_)&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
(<span style="color: #a020f0; ">match</span>&nbsp;u&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(a)&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;(t&nbsp;&#X2261;&nbsp;a)&nbsp;<span style="color: #b22222">(&#X2217;  The element is in another union-find structure.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">None</span>&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;<span style="color: #a020f0; ">false</span>);&nbsp;()&nbsp;<span style="color: #b22222">(&#X2217;  The element is in no union-find structure.  &#X2217;)</span></p><p><a id="src/support/union_find.ml:2882"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;check_unused&nbsp;(u,_)&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
(<span style="color: #a020f0; ">match</span>&nbsp;u&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Some</span>(_)&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>&nbsp;<span style="color: #a020f0; ">false</span>&nbsp;<span style="color: #b22222">(&#X2217;  The element is already in a union-find structure.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">None</span>&nbsp;&#X2192;&nbsp;())</p><p><a id="src/support/union_find.ml:3041"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;get_base&nbsp;(_,l)&nbsp;=&nbsp;l</p><p><a id="src/support/union_find.ml:3068"></a>&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Note: The cast is not dangerous, because the left-hand part is
checked first.  &#X2217;)</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;empty_link&nbsp;=&nbsp;(<span style="color: #228b22; ">None</span>,&nbsp;<span style="color: #228b22; ">Obj.</span>magic&nbsp;0)&nbsp;<BR>
<span style="color: #0000ff; font-weight: bold;">end</span><BR></code></div><span style="font-weight:bold">3.</span>&nbsp;
<a id="src/support/union_find.ml:3207"></a>The goal of the below "double functor" is to produce a module with
the following signature. In it, <code>partition</code> and <code>element</code> are
actually the same underlying type; the difference is that elements
returned with type <code>partition</code> are the root of the tree). Hiding
this in the interface provides some guarantee that arguments of type
partition are the representative of their partition.</p><p>Unfortunately, after calling <code>union</code> on two partitions <code>p1</code> and
<code>p2</code>, one of them will stop being the root; that is why the
partition arguments of <code>union</code> must not be re-used. Thus, defining
the <code>partition</code> type only guarantees that the argument has been a
root in the past, and we ensure that by a dynamic test. 
<BR><a id="src/support/union_find.ml:3929"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;<span style="color: #228b22; ">S</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">sig</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;t<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;partition<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;element<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;description<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;create:&nbsp;<span style="color: #228b22; ">unit</span>&nbsp;&#X2192;&nbsp;t<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;singleton&nbsp;:&nbsp;t&nbsp;&#X2192;&nbsp;element&nbsp;&#X2192;&nbsp;description&nbsp;&#X2192;&nbsp;partition<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;find&nbsp;:&nbsp;t&nbsp;&#X2192;&nbsp;element&nbsp;&#X2192;&nbsp;partition<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;union:&nbsp;t&nbsp;&#X2192;&nbsp;partition&nbsp;&#X2192;&nbsp;partition&nbsp;&#X2192;&nbsp;description&nbsp;&#X2192;&nbsp;partition<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;description:&nbsp;t&nbsp;&#X2192;&nbsp;partition&nbsp;&#X2192;&nbsp;description<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;set_description&nbsp;:&nbsp;t&nbsp;&#X2192;&nbsp;partition&nbsp;&#X2192;&nbsp;description&nbsp;&#X2192;&nbsp;<span style="color: #228b22; ">unit</span><BR>
<span style="color: #0000ff; font-weight: bold;">end</span></p><p></code></div>
This is a double functor with two arguments; <code><span style="color: #228b22; ">Saf</span></code> allows to
differenciate the "Fast" and "Safe" modules, while <code><span style="color: #228b22; ">Link</span></code> is used
to find and change the link. 
<BR><a id="src/support/union_find.ml:4980"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Make</span>(<span style="color: #228b22; ">Saf</span>:<span style="color: #228b22; ">SAFETY</span>):<span style="color: #228b22; ">UNION_FIND</span>&nbsp;=&nbsp;<BR>
<span style="color: #0000ff; font-weight: bold;">struct</span></p><p><a id="src/support/union_find.ml:5026"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;(&#X3B1;,&#X3B2;)&nbsp;link&nbsp;=&nbsp;(&#X3B1;,&#X3B2;)&nbsp;<span style="color: #228b22; ">Saf.</span>link</p><p><a id="src/support/union_find.ml:5067"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;empty_link&nbsp;=&nbsp;<span style="color: #228b22; ">Saf.</span>empty_link</p><p><a id="src/support/union_find.ml:5104"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;<span style="color: #228b22; ">LINK</span>&nbsp;=&nbsp;<span style="color: #0000ff; font-weight: bold;">sig</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;element<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;description<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;get:&nbsp;element&nbsp;&#X2192;&nbsp;(description,&nbsp;element)&nbsp;link&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">val</span>&nbsp;set:&nbsp;element&nbsp;&#X2192;&nbsp;(description,&nbsp;element)&nbsp;link&nbsp;&#X2192;&nbsp;<span style="color: #228b22; ">unit</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/support/union_find.ml:5290"></a>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Make</span>(<span style="color: #228b22; ">Link</span>:&nbsp;<span style="color: #228b22; ">LINK</span>)&nbsp;=<BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">struct</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;t&nbsp;=&nbsp;<span style="color: #228b22; ">Saf.</span>t<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;element&nbsp;=&nbsp;<span style="color: #228b22; ">Link.</span>element<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;description&nbsp;=&nbsp;<span style="color: #228b22; ">Link.</span>description<BR>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">type</span>&nbsp;partition&nbsp;=&nbsp;<span style="color: #228b22; ">Link.</span>element</p><p><a id="src/support/union_find.ml:5453"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;create&nbsp;=&nbsp;<span style="color: #228b22; ">Saf.</span>create<BR></code></div><span style="font-weight:bold">4.</span>&nbsp;
<a id="src/support/union_find.ml:5490"></a><code>singleton</code> is the only way to add new elements to the
union-find structure, and is the place where we check that the
element is not part of another structure. 
<BR><a id="src/support/union_find.ml:5667"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;singleton&nbsp;t&nbsp;elt&nbsp;desc&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;l&nbsp;=&nbsp;(<span style="color: #228b22; ">Link.</span>get&nbsp;elt)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Saf.</span>check_unused&nbsp;l;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Link.</span>set&nbsp;elt&nbsp;(<span style="color: #228b22; ">Saf.</span>securize&nbsp;t&nbsp;(<span style="color: #228b22; ">Partition_descriptor</span>&nbsp;{rank=0;desc=desc}));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
elt&nbsp;<BR></code></div><span style="font-weight:bold">5.</span>&nbsp;
<a id="src/support/union_find.ml:5856"></a>Basically, <code>find</code> just walks the tree until it finds the root.</p><p>But performance is increased if the length of the path is
diminished: traversed nodes are linked to nodes that are closer
to the roof. The possibility we have implemented is path
compression: when the root is found, the elements are changed
to link to the it, so that subsequent calls are faster. We
implemented a tail-recursive version of this algorithm (which
still requires two pass).</p><p>Note: there are alternatives to path compression, such that
halving; but in Tarjan&#X2019;s structure the root is linked to
itself, which is not the case here, so halving would require
more checks than in Tarjan&#X2019;s version. Thus we stick with path
compression. </p><p>Note: we could perform a lighter check in the safe version by
checking only the argument, and not all recursive calls; this is
probably not worth implementing it, and the heavy check has its
uses. 
<BR><a id="src/support/union_find.ml:6868"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;find&nbsp;t&nbsp;x&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Tail-recursive function to find the root of the algorithm.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">rec</span>&nbsp;find&nbsp;x&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;l&nbsp;=&nbsp;(<span style="color: #228b22; ">Link.</span>get&nbsp;x)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Saf.</span>check_membership&nbsp;t&nbsp;l;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;<span style="color: #228b22; ">Saf.</span>get_base&nbsp;l&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Partition_descriptor</span>(s)&nbsp;&#X2192;&nbsp;x<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Parent</span>(y)&nbsp;&#X2192;&nbsp;find&nbsp;y&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  This is also tail-recursive, but we do not perform the checks
the second time. &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;<span style="color: #0000ff; font-weight: bold;">rec</span>&nbsp;compress&nbsp;x&nbsp;r&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;l&nbsp;=&nbsp;(<span style="color: #228b22; ">Link.</span>get&nbsp;x)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;<span style="color: #228b22; ">Saf.</span>get_base&nbsp;l&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Partition_descriptor</span>(s)&nbsp;&#X2192;&nbsp;()<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Parent</span>(y)&nbsp;&#X2192;&nbsp;<span style="color: #228b22; ">Link.</span>set&nbsp;x&nbsp;(<span style="color: #228b22; ">Saf.</span>securize&nbsp;t&nbsp;(<span style="color: #228b22; ">Parent</span>&nbsp;r))&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;root&nbsp;=&nbsp;find&nbsp;x&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
compress&nbsp;x&nbsp;root;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
root<BR></code></div><span style="font-weight:bold">6.</span>&nbsp;
<a id="src/support/union_find.ml:7541"></a>The following functions work only when the given element is
the root of a partition, but check that. 
<BR><a id="src/support/union_find.ml:7653"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;get_partition_descriptor&nbsp;t&nbsp;p&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;l&nbsp;=&nbsp;(<span style="color: #228b22; ">Link.</span>get&nbsp;p)&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Saf.</span>check_membership&nbsp;t&nbsp;l;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">match</span>&nbsp;<span style="color: #228b22; ">Saf.</span>get_base&nbsp;l&nbsp;<span style="color: #a020f0; ">with</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;<span style="color: #228b22; ">Partition_descriptor</span>(s)&nbsp;&#X2192;&nbsp;s<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&#X2223;&nbsp;_&nbsp;&#X2192;&nbsp;<span style="color: #a020f0; ">assert</span>(<span style="color: #a020f0; ">false</span>)&nbsp;<span style="color: #b22222">(&#X2217;  The element is not a partition.  &#X2217;)</span></p><p><a id="src/support/union_find.ml:7897"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;description&nbsp;t&nbsp;x&nbsp;=&nbsp;(get_partition_descriptor&nbsp;t&nbsp;x).desc</p><p><a id="src/support/union_find.ml:7962"></a>&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;set_description&nbsp;t&nbsp;x&nbsp;desc&nbsp;=&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;pd&nbsp;=&nbsp;get_partition_descriptor&nbsp;t&nbsp;x&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
pd.desc&nbsp;&#X2190;&nbsp;desc<BR></code></div><span style="font-weight:bold">7.</span>&nbsp;
<a id="src/support/union_find.ml:8080"></a>This function performs the union of two partitions. We use
rank to find which should be the root : we attach the smaller
tree to the root of the larger tree, so as not to increase the
maximum height (i.e. path length) of the resulting tree.</p><p>The last argument allows to update the set descriptor along
with this operation.</p><p>Note that this function takes partitions as argument; one could
have instead taken any element, and performed the find inside
the function; in particular some efficient algorithms
interleave the find and union operations. The reason why we
take partition arguments is that it avoids a find when we know
that the argument is a partition (for instance when merging
with a just-created singleton), and the user needs to perform a
find to retrieve and merge the description in the algorithms we
use (such as unification). 
<BR><a id="src/support/union_find.ml:9011"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;union&nbsp;t&nbsp;p1&nbsp;p2&nbsp;newdesc&nbsp;=</p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
This function also checks that p1 and p2 are partitions. 
<BR><a id="src/support/union_find.ml:9114"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;d1&nbsp;=&nbsp;get_partition_descriptor&nbsp;t&nbsp;p1&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">let</span>&nbsp;d2&nbsp;=&nbsp;get_partition_descriptor&nbsp;t&nbsp;p2&nbsp;<span style="color: #0000ff; font-weight: bold;">in</span></p><p></code></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Alternatively, the check that p1 and p2 are different could
have been done here. 
<BR><a id="src/support/union_find.ml:9313"></a>
<div class="ocamlweb-src"><code>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">assert</span>&nbsp;(p1&nbsp;&#X2262;&nbsp;p2);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">if</span>(&nbsp;d1.rank&nbsp;&lt;&nbsp;d2.rank)&nbsp;<span style="color: #a020f0; ">then</span>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">begin</span>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Keep <code>d2_repr</code> as root. Height of the merge is
<code>max(d1_height&nbsp;+&nbsp;1,&nbsp;d2_height)</code> so does not change.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Link.</span>set&nbsp;p1&nbsp;(<span style="color: #228b22; ">Saf.</span>securize&nbsp;t&nbsp;(<span style="color: #228b22; ">Parent</span>&nbsp;p2));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
d2.desc&nbsp;&#X2190;&nbsp;newdesc;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
p2<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">else</span>&nbsp;<span style="color: #a020f0; ">if</span>&nbsp;(d1.rank&nbsp;&gt;&nbsp;d2.rank)&nbsp;<span style="color: #a020f0; ">then</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">begin</span>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  Keep <code>d1_repr</code> as root. Height of the merge is
<code>max(d2_height&nbsp;+&nbsp;1,&nbsp;d1_height)</code> so does not change.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Link.</span>set&nbsp;p2&nbsp;(<span style="color: #228b22; ">Saf.</span>securize&nbsp;t&nbsp;(<span style="color: #228b22; ">Parent</span>&nbsp;p1));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
d1.desc&nbsp;&#X2190;&nbsp;newdesc;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
p1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #a020f0; ">else</span>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">begin</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #b22222">(&#X2217;  We choose arbitrarily p1 to be the root. 
	 The height may have changed, as all elements in the subset
	 with root p2 are 1 step further to the root.  &#X2217;)</span><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #228b22; ">Link.</span>set&nbsp;p2&nbsp;(<span style="color: #228b22; ">Saf.</span>securize&nbsp;t&nbsp;(<span style="color: #228b22; ">Parent</span>&nbsp;p1));<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
d1.rank&nbsp;&#X2190;&nbsp;d1.rank&nbsp;+&nbsp;1;&nbsp;d1.desc&nbsp;&#X2190;&nbsp;newdesc;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
p1<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span><BR>&nbsp;&nbsp;
<span style="color: #0000ff; font-weight: bold;">end</span></p><p><a id="src/support/union_find.ml:10216"></a>
<span style="color: #0000ff; font-weight: bold;">end</span><BR></code></div><span style="font-weight:bold">8.</span>&nbsp;
<a id="src/support/union_find.ml:10225"></a>The double-functor is not shown in the exposed interface, and we
only export the following, simpler modules. 
<BR><a id="src/support/union_find.ml:10341"></a>
<div class="ocamlweb-src"><code>

<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Fast</span>=<span style="color: #228b22; ">Make</span>(<span style="color: #228b22; ">No_safety</span>)</p><p><a id="src/support/union_find.ml:10371"></a>
<span style="color: #0000ff; font-weight: bold;">module</span>&nbsp;<span style="color: #228b22; ">Safe</span>=<span style="color: #228b22; ">Make</span>(<span style="color: #228b22; ">Safety</span>)<BR></code></div><span style="font-weight:bold">9.</span>&nbsp;
<a id="src/support/union_find.ml:10401"></a>For a survey of the implementations of union-find algorithms, one
should read "Worst-Case Analysis of Set Union Algorithms", by
Tarjan and Van Leeuwen.</p><p>Recent performance comparison of these algorithms (and modern
enhancements) can be found in "Experiments on Union-Find Algorithms
for the Disjoint-Set Data Structure", by Md. Mostofa Ali Patwary,
Jean Blair, Fredrik Manne. 
<BR></p><!--CUT END -->



    <hr />
  </div>
</div>
 
     </div>
          

   
   <script src="/js/jquery.js"></script>
   

   <script src="/js/bootstrap.min.js"></script>

   
   <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
     ga('create', 'UA-42249123-1', 'l-lang.org');
     ga('send', 'pageview');
   </script>

   
   <script type="text/javascript">
   $('.my-email').html(function(){
	var d = "t@l-la";
	var e = "ma";
	var a = "t";
	var c = "ng.org";
	var h = 'mailto:' + e + a + d + c;
	$(this).parent('a').attr('href', h);
	return e + a + d + c;
   });
   </script>

  </body>
</html>
